<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ°´æœç›¤æŠ½ç±¤æ©Ÿ - AI ç­ç´šå¼·åŒ–ç‰ˆ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Bungee+Spice&family=Noto+Sans+TC:wght@900&display=swap');

        :root {
            --gold: #ffd700;
            --dark-red: #8b0000;
            --neon-red: #ff3131;
        }

        body {
            background-color: #1a1a1a;
            font-family: 'Noto Sans TC', sans-serif;
            color: white;
            overflow-x: hidden;
        }

        .slot-machine-container {
            background: linear-gradient(180deg, #444 0%, #222 100%);
            border: 10px solid #555;
            border-radius: 40px;
            box-shadow: 0 20px 50px rgba(0,0,0,0.8), inset 0 0 20px rgba(255,255,255,0.1);
            position: relative;
        }

        .slot-window {
            height: 150px;
            background: #000;
            border: 4px solid var(--gold);
            border-radius: 10px;
            overflow: hidden;
            position: relative;
            box-shadow: inset 0 0 15px rgba(255,215,0,0.5);
        }

        .reel {
            display: flex;
            flex-direction: column;
            align-items: center;
            transition: transform 3s cubic-bezier(0.1, 0, 0.1, 1);
            will-change: transform;
        }

        .slot-item {
            height: 150px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-size: 3.5rem;
            font-weight: 900;
            text-shadow: 0 0 10px rgba(255,255,255,0.5);
            width: 100%;
            border-bottom: 1px solid #222;
        }

        .winner-glow {
            animation: glow 0.5s ease-in-out infinite alternate;
        }

        @keyframes glow {
            from { box-shadow: 0 0 5px var(--gold); border-color: var(--gold); }
            to { box-shadow: 0 0 20px var(--gold); border-color: #fff; }
        }

        .lever-handle {
            width: 20px;
            height: 120px;
            background: linear-gradient(90deg, #888, #eee, #888);
            position: absolute;
            right: -30px;
            top: 50px;
            border-radius: 10px;
            transform-origin: bottom center;
            transition: transform 0.5s;
            cursor: pointer;
        }

        .lever-pull {
            transform: rotateX(180deg) translateY(100px);
        }

        .neon-text {
            color: #fff;
            text-shadow: 0 0 5px #fff, 0 0 10px #fff, 0 0 20px var(--neon-red), 0 0 30px var(--neon-red);
            font-family: 'Bungee Spice', cursive;
        }

        textarea {
            background: #222;
            border: 2px solid #444;
            color: var(--gold);
            scrollbar-width: thin;
        }

        .ai-card {
            background: rgba(30, 41, 59, 0.9);
            border: 1px solid rgba(255, 215, 0, 0.3);
            backdrop-filter: blur(10px);
        }
        
        @keyframes sparkle {
            0% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.1); opacity: 0.8; }
            100% { transform: scale(1); opacity: 1; }
        }
        .animate-sparkle {
            animation: sparkle 1.5s infinite;
        }

        /* ä¸‹æ‹‰é¸å–®æ¨£å¼ */
        select {
            background-color: #333;
            color: #ffd700;
            border: 1px solid #555;
            padding: 10px;
            border-radius: 8px;
            outline: none;
            width: 100%;
            cursor: pointer;
        }
        select:focus {
            border-color: #ffd700;
        }
    </style>
</head>
<body class="flex flex-col items-center justify-center min-h-screen p-4">

    <!-- éŸ³æ•ˆæ§åˆ¶ -->
    <div class="fixed top-4 right-4 z-50 flex items-center gap-4 bg-black/50 p-3 rounded-full border border-gray-600">
        <span id="audioStatus" class="text-xs text-gray-400">éŸ³æ•ˆå·²é—œé–‰</span>
        <button id="toggleAudio" class="text-2xl">ğŸ”‡</button>
    </div>

    <h1 class="text-5xl mb-8 neon-text tracking-widest text-center">NAME SLOT</h1>

    <div class="flex flex-col lg:flex-row gap-8 items-start w-full max-w-5xl">
        
        <!-- å·¦å´ï¼šè¼¸å…¥åå–®èˆ‡ç­ç´šé¸æ“‡ -->
        <div class="w-full lg:w-1/3 bg-gray-900 p-6 rounded-3xl shadow-2xl border-4 border-gray-800">
            <h2 class="text-xl mb-4 text-yellow-400 font-bold flex items-center gap-2">
                <span>ğŸ“‹</span> æŠ½ç±¤åå†Š
            </h2>
            
            <!-- ç­ç´šä¸‹æ‹‰é¸å–® -->
            <div class="mb-4">
                <label class="block text-gray-400 text-xs mb-1 font-bold">å¿«é€Ÿè¼‰å…¥åå–®ï¼š</label>
                <select id="classSelect">
                    <option value="">-- è«‹é¸æ“‡ç­ç´š --</option>
                    <option value="electronics1A">é›»å­ä¸€ç”²</option>
                    <option value="dataProcess2A">è³‡è™•äºŒç”²</option>
                    <option value="mechanics3A">æ©Ÿæ¢°ä¸‰ç”²</option>
                    <option value="dataProcess3A">è³‡è™•ä¸‰ç”²</option>
                </select>
            </div>

            <textarea id="nameInput" class="w-full h-64 p-4 rounded-xl focus:outline-none focus:border-yellow-500 text-lg" placeholder="æ¯è¡Œä¸€å€‹åå­—"></textarea>
            
            <div class="flex justify-between items-center mt-2">
                <p class="text-gray-400 text-sm">ç›®å‰äººæ•¸ï¼š<span id="nameCount">0</span></p>
                <button id="resetBtn" class="text-xs bg-red-700 hover:bg-red-600 px-3 py-1 rounded text-white transition-colors font-bold">é‡è¨­æ©Ÿå°</button>
            </div>
        </div>

        <!-- å³å´ï¼šè€è™æ©Ÿæœ¬é«” -->
        <div class="w-full lg:w-2/3 flex flex-col items-center">
            <div class="slot-machine-container p-8 w-full max-w-md relative">
                
                <div class="grid grid-cols-3 gap-3 mt-4">
                    <div class="slot-window" id="window1">
                        <div class="reel" id="reel1"></div>
                    </div>
                    <div class="slot-window" id="window2">
                        <div class="reel" id="reel2"></div>
                    </div>
                    <div class="slot-window" id="window3">
                        <div class="reel" id="reel3"></div>
                    </div>
                </div>

                <div class="mt-8 flex justify-center">
                    <button id="spinBtn" class="bg-gradient-to-b from-yellow-400 to-yellow-600 hover:from-yellow-300 hover:to-yellow-500 text-dark-red text-2xl font-black py-4 px-12 rounded-full shadow-[0_5px_0_#b8860b] active:translate-y-1 active:shadow-none transition-all uppercase tracking-widest">
                        SPIN!
                    </button>
                </div>

                <div class="hidden md:block absolute -right-4 top-1/2 -translate-y-1/2">
                    <div class="w-10 h-24 bg-gray-700 rounded-lg"></div>
                    <div id="lever" class="lever-handle">
                        <div class="w-12 h-12 bg-red-600 rounded-full absolute -top-8 -left-3 shadow-xl"></div>
                    </div>
                </div>
            </div>

            <div id="resultArea" class="mt-8 w-full max-w-md flex flex-col items-center">
                <div id="resultDisplay" class="opacity-0 transform scale-50 transition-all duration-500 text-center mb-6">
                    <p class="text-2xl font-bold text-yellow-400">ğŸ‰ æ­å–œä¸­ç ğŸ‰</p>
                    <span id="winnerName" class="text-white text-6xl font-black underline block mt-2">---</span>
                </div>

                <button id="aiFeatureBtn" class="hidden animate-sparkle bg-gradient-to-r from-purple-600 to-blue-600 text-white font-bold py-3 px-6 rounded-2xl shadow-lg hover:scale-105 transition-transform flex items-center gap-2">
                    âœ¨ è®“ AI åˆ†æé€™ä½å¹¸é‹å…’
                </button>

                <div id="aiResponse" class="hidden mt-4 ai-card p-6 rounded-3xl w-full border border-purple-500/50 relative overflow-hidden">
                    <div id="aiLoading" class="hidden flex justify-center items-center py-4">
                        <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-white"></div>
                    </div>
                    <p id="aiContent" class="text-gray-100 italic leading-relaxed"></p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // --- å­¸ç”Ÿæ•¸æ“šåº« ---
        const studentData = {
            electronics1A: "ç‹ä¿¡å„„\nä½™æµšé§¦\nä½™å­¸æ‰¿\nææ¿¬ä½‘\næ—ç‰é¨°\næ—æ˜†å„€\næ—ç›ˆå­œ\næ´ªå¨å»·\næ´ªéƒç¨‹\næ´ªç¦\næ´ªèˆˆè²¡\nå¼µè‚²ç¦\nå¼µèŠ¯èª\nç²˜å˜‰æ³“\nè¨±ç«£åµƒ\né™³æ¬£å„€\né™³æ£®è±ª\né™³é§¿æœ‹\nè©¹åº­è±ª\nåŠ‰é€²æ˜\næ­å‰èŠ©\nè”¡æ³“å½¥\næˆ´é‡‡ç¾½\nè¬æ²‚éˆ\nè¬å²«è\nè¬ç§‰å®¸\néƒ­èŠ¯å¦‚",
            dataProcess2A: "çŸ³æ‰¿å³\nå³ç¾¿éœˆ\næ—å¦¤æ©\nè¨±èŠ³ç››\néƒ­æ´§å²‘\né™³æ€¡å–¬\né»ƒå®œç‘©\né»ƒä¿è\né»ƒéˆºç´”\næ¥ŠèŒµæ·‡\næ¥Šé®å½¥\né„æŒºå‹›",
            mechanics3A: "ç‹å½¥æ–‡\nç‹ç¾é›…\nç‹ç¥ç’Ÿ\nç‹åœ‹ä»»\nå³å®—ç¥\nå³å®¥é¨°\næ˜“æ˜Œå‰\næ—æ‰¿ä½‘\næ—æ ¹å®‡\næ—ç¥å®‡\næ—è£•å±•\næ´ªéˆç¿”\næ´ªéˆºå˜‰\næ´ªç²¾å‘ˆ\nå¼µå®¶è±ª\nèŠéˆå‡±\né™³å¼˜ç¿°\né™³å®æ©\né™³æŸå¡\né»ƒè¶…è£•\næ¥Šè‡ªç«‹\næ¥Šå…¸å¶§\næ¥Šæ‰¿å‹³\né›·å•Ÿæš\nåŠ‰ç¦è‡¨\nè”¡å®åŠ¼\nç›§éƒè« \nè–›ä¼ç«£",
            dataProcess3A: "å³å©‰æ­†\næ—ç¦¹è³“\næ›¹å·§è–‡\nè¨±éšæ¶µ\né™³æ•¬ä½‘\næ›¾å®œç¨š\né»ƒå­æ™‰\næ¥Šé”è”š\nè©¹äºåº­\nè”¡å©‰ç­ \nè¬èŠ·å¦¤\nè¬ç¢©è«º\né¡ç‰ç³\né™³å“ç‘œ\næ—æšé„—"
        };

        const classSelect = document.getElementById('classSelect');
        const nameInput = document.getElementById('nameInput');

        classSelect.addEventListener('change', (e) => {
            const selectedClass = e.target.value;
            if (studentData[selectedClass]) {
                nameInput.value = studentData[selectedClass];
                updateCount();
                initSlot();
            }
        });

        // --- Gemini API æ•´åˆ ---
        const apiKey = ""; 
        
        async function fetchAIAnalysis(name) {
            const aiContent = document.getElementById('aiContent');
            const aiLoading = document.getElementById('aiLoading');
            const aiResponse = document.getElementById('aiResponse');
            
            aiContent.innerText = "";
            aiResponse.classList.remove('hidden');
            aiLoading.classList.remove('hidden');

            const systemPrompt = "ä½ æ˜¯ä¸€ä½å¹½é»˜çš„è€è™æ©Ÿå¤§å¸«ã€‚è«‹é‡å°æŠ½ä¸­åå­—çš„äººï¼Œå¯«ä¸€æ®µç°¡çŸ­ï¼ˆ50å­—å…§ï¼‰çš„è¶£å‘³æ€§æ ¼è§£ææˆ–ä»Šæ—¥é‹å‹¢ã€‚å£æ°£è¦ç†±æƒ…ã€å……æ»¿æ´»åŠ›ï¼Œå¸¶é»è³­å ´å¤§è´å®¶çš„æ°›åœã€‚è«‹ä½¿ç”¨ç¹é«”ä¸­æ–‡ã€‚";
            const userQuery = `ä¸­çè€…æ˜¯ï¼š${name}ã€‚è«‹çµ¦ä»–ä¸€æ®µå¹¸é‹é»è©•ã€‚`;

            let retries = 0;
            const maxRetries = 5;
            const delays = [1000, 2000, 4000, 8000, 16000];

            async function callApi() {
                try {
                    const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            contents: [{ parts: [{ text: userQuery }] }],
                            systemInstruction: { parts: [{ text: systemPrompt }] }
                        })
                    });
                    
                    if (!response.ok) throw new Error('API Error');
                    const result = await response.json();
                    const text = result.candidates?.[0]?.content?.parts?.[0]?.text;
                    aiLoading.classList.add('hidden');
                    aiContent.innerText = text || "AI æš«æ™‚å¤±å»äº†éˆæ„Ÿï¼Œä½†ä»–ä¸€å®šè¦ºå¾—ä½ å¾ˆæ£’ï¼";
                } catch (error) {
                    if (retries < maxRetries) {
                        setTimeout(callApi, delays[retries]);
                        retries++;
                    } else {
                        aiLoading.classList.add('hidden');
                        aiContent.innerText = "é€£ç·šè¶…æ™‚ï¼Œä¸éå¥½é‹ä¾ç„¶çœ·é¡§ä½ ï¼";
                    }
                }
            }
            callApi();
        }

        // --- éŸ³æ•ˆèˆ‡æ©Ÿå°é‚è¼¯ ---
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        let audioEnabled = false;

        function playTone(freq, type, duration, volume = 0.1) {
            if (!audioEnabled) return;
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.type = type;
            osc.frequency.setValueAtTime(freq, audioCtx.currentTime);
            gain.gain.setValueAtTime(volume, audioCtx.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.0001, audioCtx.currentTime + duration);
            osc.connect(gain);
            gain.connect(audioCtx.destination);
            osc.start();
            osc.stop(audioCtx.currentTime + duration);
        }

        const sounds = {
            lever: () => { playTone(150, 'sine', 0.2, 0.3); },
            spin: () => {
                const interval = setInterval(() => {
                    if (!isSpinning) { clearInterval(interval); return; }
                    playTone(Math.random() * 200 + 400, 'square', 0.05, 0.02);
                }, 100);
            },
            stop: () => playTone(200, 'triangle', 0.2, 0.2),
            win: () => {
                [523.25, 659.25, 783.99, 1046.50].forEach((note, i) => {
                    setTimeout(() => playTone(note, 'sine', 0.6, 0.2), i * 150);
                });
            }
        };

        const toggleAudioBtn = document.getElementById('toggleAudio');
        toggleAudioBtn.addEventListener('click', () => {
            audioEnabled = !audioEnabled;
            if (audioEnabled && audioCtx.state === 'suspended') audioCtx.resume();
            toggleAudioBtn.innerText = audioEnabled ? 'ğŸ”Š' : 'ğŸ”‡';
            document.getElementById('audioStatus').innerText = audioEnabled ? 'éŸ³æ•ˆå·²é–‹å•Ÿ' : 'éŸ³æ•ˆå·²é—œé–‰';
        });

        const nameCountDisplay = document.getElementById('nameCount');
        const spinBtn = document.getElementById('spinBtn');
        const resetBtn = document.getElementById('resetBtn');
        const lever = document.getElementById('lever');
        const aiFeatureBtn = document.getElementById('aiFeatureBtn');
        const reels = [document.getElementById('reel1'), document.getElementById('reel2'), document.getElementById('reel3')];
        const resultDisplay = document.getElementById('resultDisplay');
        const winnerNameText = document.getElementById('winnerName');
        const windows = [document.getElementById('window1'), document.getElementById('window2'), document.getElementById('window3')];

        const FRUITS = ['ğŸ', 'ğŸ‹', 'ğŸ’', 'ğŸ‡', 'ğŸ‰', 'ğŸ“', 'ğŸ', 'ğŸ””', '7ï¸âƒ£'];
        let isSpinning = false;
        let currentWinner = "";

        function updateCount() {
            const names = nameInput.value.split('\n').filter(n => n.trim() !== '');
            nameCountDisplay.innerText = names.length;
        }

        function initSlot() {
            reels.forEach(reel => {
                reel.style.transition = 'none';
                reel.style.transform = 'translateY(0)';
                reel.innerHTML = `<div class="slot-item text-gray-700">?</div>`;
            });
            resultDisplay.classList.add('opacity-0', 'scale-50');
            aiFeatureBtn.classList.add('hidden');
            document.getElementById('aiResponse').classList.add('hidden');
            winnerNameText.innerText = '---';
            windows.forEach(w => w.classList.remove('winner-glow'));
        }

        nameInput.addEventListener('input', updateCount);
        updateCount();
        initSlot();

        async function spin() {
            if (isSpinning) return;
            const names = nameInput.value.split('\n').filter(n => n.trim() !== '');
            if (names.length < 1) return alert('è«‹è¼¸å…¥æˆ–é¸æ“‡åå–®ï¼');

            isSpinning = true;
            spinBtn.disabled = true;
            resetBtn.disabled = true;
            classSelect.disabled = true;
            resultDisplay.classList.add('opacity-0', 'scale-50');
            aiFeatureBtn.classList.add('hidden');
            document.getElementById('aiResponse').classList.add('hidden');
            windows.forEach(w => w.classList.remove('winner-glow'));

            lever.classList.add('lever-pull');
            sounds.lever();
            setTimeout(() => lever.classList.remove('lever-pull'), 500);
            sounds.spin();

            currentWinner = names[Math.floor(Math.random() * names.length)];
            
            const parts = [
                currentWinner.charAt(0) || '?',
                currentWinner.charAt(1) || 'â¤ï¸',
                currentWinner.substring(2) || 'â­'
            ];

            const reelCount = 30; 
            reels.forEach((reel, index) => {
                reel.style.transition = 'none';
                reel.style.transform = 'translateY(0)';
                
                let content = '';
                for (let i = 0; i < reelCount; i++) {
                    const randomFruit = FRUITS[Math.floor(Math.random() * FRUITS.length)];
                    content += `<div class="slot-item">${randomFruit}</div>`;
                }
                content += `<div class="slot-item text-yellow-400">${parts[index]}</div>`;
                
                reel.innerHTML = content;
                reel.offsetHeight;

                setTimeout(() => {
                    reel.style.transition = `transform ${2 + index * 0.8}s cubic-bezier(0.1, 0, 0.1, 1)`;
                    reel.style.transform = `translateY(-${reelCount * 150}px)`;
                    setTimeout(() => sounds.stop(), 2000 + index * 800);
                }, index * 200);
            });

            setTimeout(() => {
                isSpinning = false;
                spinBtn.disabled = false;
                resetBtn.disabled = false;
                classSelect.disabled = false;
                winnerNameText.innerText = currentWinner;
                resultDisplay.classList.remove('opacity-0', 'scale-50');
                resultDisplay.classList.add('opacity-100', 'scale-100');
                aiFeatureBtn.classList.remove('hidden');
                windows.forEach(w => w.classList.add('winner-glow'));
                sounds.win();
            }, 4500);
        }

        aiFeatureBtn.addEventListener('click', () => fetchAIAnalysis(currentWinner));
        resetBtn.addEventListener('click', () => { if (!isSpinning) initSlot(); });
        spinBtn.addEventListener('click', spin);
        lever.addEventListener('click', spin);
    </script>
</body>
</html>